#!/bin/bash

# –ö–æ–ª—å–æ—Ä–∏ –¥–ª—è –≤–∏–≤–æ–¥—É
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –ü–æ—á–∏–Ω–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...${NC}\n"

echo -e "${BLUE}üì¶ –ö—Ä–æ–∫ 1: –ó–±—ñ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É${NC}"
docker-compose --profile app build
if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±—ñ—Ä—Ü—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É"
    exit 1
fi
echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —É—Å–ø—ñ—à–Ω–æ –∑—ñ–±—Ä–∞–Ω—ñ${NC}\n"

echo -e "${BLUE}üì¶ –ö—Ä–æ–∫ 2: –ó–±—ñ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ —Ç–µ—Å—Ç–∞–º–∏${NC}"
docker-compose --profile test build
if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±—ñ—Ä—Ü—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ —Ç–µ—Å—Ç–∞–º–∏"
    exit 1
fi
echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ —Ç–µ—Å—Ç–∞–º–∏ —É—Å–ø—ñ—à–Ω–æ –∑—ñ–±—Ä–∞–Ω–∏–π${NC}\n"

echo -e "${BLUE}üöÄ –ö—Ä–æ–∫ 3: –ó–∞–ø—É—Å–∫ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É${NC}"
docker-compose --profile app up -d
if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É"
    exit 1
fi
echo -e "${GREEN}‚úÖ –ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∏–π${NC}\n"

echo -e "${BLUE}üß™ –ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤${NC}"
docker-compose --profile test up
TEST_RESULT=$?
if [ $TEST_RESULT -ne 0 ]; then
    echo "‚ùå –¢–µ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –∑ –ø–æ–º–∏–ª–∫–∞–º–∏"
else
    echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ñ${NC}"
fi

echo -e "\n${BLUE}üîÑ –ö—Ä–æ–∫ 5: –ó—É–ø–∏–Ω–∫–∞ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É${NC}"
docker-compose down
if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑—É–ø–∏–Ω—Ü—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É"
    exit 1
fi
echo -e "${GREEN}‚úÖ –ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —É—Å–ø—ñ—à–Ω–æ –∑—É–ø–∏–Ω–µ–Ω–æ${NC}\n"

# –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç—ñ–≤
exit $TEST_RESULT